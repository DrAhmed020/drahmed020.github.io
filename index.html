<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إضافة ملاحظة</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // إعداد Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDEWffPfy-fljp32H8AjemraCau-f9JN-M",
            authDomain: "student-notes-app-3d196.firebaseapp.com",
            projectId: "student-notes-app-3d196",
            storageBucket: "student-notes-app-3d196.appspot.com",
            messagingSenderId: "99837564904",
            appId: "1:99837564904:web:6b880e2b80e439c8fcf65d",
            measurementId: "G-N63JWQNTZF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // التعامل مع إرسال النموذج
        document.getElementById("noteForm").addEventListener("submit", async (e) => {
            e.preventDefault(); // منع الإرسال الافتراضي

            const name = document.getElementById("name").value;
            const grade = document.getElementById("grade").value;
            const note = document.getElementById("note").value;
            const imageInput = document.getElementById("image");
            let imageURL = null;

            if (imageInput.files.length > 0) {
                const file = imageInput.files[0];
                const reader = new FileReader();

                reader.onload = async (e) => {
                    imageURL = e.target.result;

                    // إضافة الملاحظة إلى Firestore
                    try {
                        await addDoc(collection(db, "notes"), {
                            name,
                            grade,
                            note,
                            image: imageURL,
                            timestamp: Date.now() // إضافة timestamp
                        });
                        alert("تمت إضافة الملاحظة بنجاح!");
                        document.getElementById("noteForm").reset();
                    } catch (error) {
                        console.error("خطأ أثناء الإضافة:", error);
                        alert("حدث خطأ أثناء إضافة الملاحظة.");
                    }
                };

                reader.readAsDataURL(file);
            } else {
                // إذا لم تكن هناك صورة
                try {
                    await addDoc(collection(db, "notes"), {
                        name,
                        grade,
                        note,
                        image: null,
                        timestamp: Date.now() // إضافة timestamp
                    });
                    alert("تمت إضافة الملاحظة بنجاح!");
                    document.getElementById("noteForm").reset();
                } catch (error) {
                    console.error("خطأ أثناء الإضافة:", error);
                    alert("حدث خطأ أثناء إضافة الملاحظة.");
                }
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>إضافة ملاحظة</h1>
        <form id="noteForm">
            <input type="text" id="name" placeholder="الاسم" required>
            <input type="text" id="grade" placeholder="المرحلة" required>
            <textarea id="note" placeholder="الملاحظة" required></textarea>
            <input type="file" id="image" accept="image/*">
            <button type="submit">إضافة الملاحظة</button>
        </form>
    </div>
</body>
</html>
